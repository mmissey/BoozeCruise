<html>
<head>
	<title>Booze Cruise</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
	<link href="css/cards.css" rel="stylesheet" media="screen">
	<style type="text/css">
		body{
			text-align: center;
			font-size: 0.8em;
		}
		.river{
			width: 50px;
			height: 50px;
		}
		.playingCards div, .playingCards ul{
			float: left;
		}
		.playingCards{
			margin: 0 auto;
			width: 620px;
		}
		#dirArrow{
			font-size: 80px;
			text-align: center;
			width: 75px;
			height: 75px;
			margin: 0 auto;
		}
		ul{
			width: 5.3em;
			clear: none !important;
		}
		#hilotext{
			font-size: 20px;
		}
		.choice{
			height: 50px;
			display: none;
		}
        .back .suit{
            display: none !important;Æ’
        }
        .back{
             background-image: url(data:image/gif;base64,R0lGODlhJAAkAJEAAOjFsezdztOKbL5QKCH5BAAAAAAALAAAAAAkACQAAAL/HC4RAqm/mmLHyHmAbczB11Ea8ombJKSgKo6Z17pXFznmS1JptiX0z3vVhpEKDoUIkoa0olGIUeZUk1RI6Yn2mh/FDAt6frOrRRTqXPpsVLYugzxaVy+YcBdnoWPZOT0E4eckQtZFZBjWoHixQFWl6Nhol6R2p1Okt5TGaEWZA6fjiMdhZgPHeWrTWGVq+jTZg1HYyAEWKLYzmyiGKoUimilz+YYryyTlg5RcDJSAbNx0Q7lMcbIGEyzTK8zVdfVaImzs/QV+prYqWWW2ObkoOApM/Em/rUlIm7fijs8a2EEKEaZ3AsMUgneEU6RcpJbZ27aGHkAO2Ors8xQH1IR0Bn5YnOtVAAA7) !important; /* image is "Pattern 069" from http://www.squidfingers.com/patterns/ */
            background-repeat: repeat !important;
        }
		#drink, #result{
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			font-size: 60px;
			display: none;
			padding-top: 25%;
			color: #FFFFFF;
		}
		#drinkText{
            float: right;
            width: 50%;
            line-height: 1em;
            font-weight: bold;
            text-shadow: 2px 2px 2px #000000, -2px -2px 2px #000000, -2px 2px 2px #000000, 2px -2px 2px #000000;
        }
        #resultCard{
            float: left;
            margin-top: -25%;
        }
        #result{
            color: #000000;
        }
	</style>
	<script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/playingCards.js"></script>
    <script type="text/javascript">
    var waitTime = 750;
    	var deck;
    	var suitClass = {
    		'H' : 'hearts',
    		'D' : 'diams',
    		'C' : 'clubs',
    		'S' : 'spades'
    	};
    	var cardVal ={
    		'2' : 2,
    		'3' : 3,
    		'4' : 4,
    		'5' : 5,
    		'6' : 6,
    		'7' : 7,
    		'8' : 8,
    		'9' : 9,
    		'10': 10,
    		'J' : 11,
    		'Q' : 12,
    		'K' : 13,
    		'A' : 14
    	}
    	var pos = 0;
    	var direction = "forward";
    	function newGame(){
    		$('.choice').show();
            $('.hand').empty();
            pos = 0;
    		direction = "forward";
    		deck = new playingCards();
    		deck.shuffle();
    		var card;
    		$.each($('.card'), function(i, v){
    			card = deck.draw();
    			while(card.rank == "N"){card = deck.draw();} //No Jokers
    			displayCard($('#card' + i), card);
    		});
    		updateBoard();
    	}
    	function showResult(dType, callback){
    		$('#drink').bind('click', function(){
	    		$('#drink').unbind('click').hide();
	    		if(callback){
	    			callback();
	    		}
	    	}).show();
            $('#drinkText').text('');
            $('#drink').css('background-color', 'rgba(0,0,255, 0.7)');
            switch(dType){
                case 'river':
                    $('#result').hide();
                    $('#drinkText').text('DRINK FOR THE RIVER!').css('width', '100%');
                break;
                case 'double':
                    hideCards();
                    $('#result').show();
                    setTimeout(function(){
                        $('#drinkText').text('SAME CARD! DRINK DOUBLE!').css('width', '50%');
                        $('#drink').css('background-color', 'rgba(255,0,0, 0.7)');
                        revealCard();
                    }, waitTime);
                    
                break;
                case 'single':
                    hideCards();
                    $('#result').show();
                    setTimeout(function(){
                        $('#drinkText').text('WRONG! DRINK!').css('width', '50%');
                        $('#drink').css('background-color', 'rgba(255,0,0, 0.7)');
                        revealCard();
                    }, waitTime);
                break;
                case 'correct':
                    hideCards();
                    $('#result').show();
                    setTimeout(function(){
                    $('#drinkText').text('CORRECT!').css('width', '50%');
                    $('#drink').css('background-color', 'rgba(0,150,0, 0.7)');
                    revealCard();
                    }, waitTime);
                break;
                case 'finish':
                    $('#result').hide();
                    $('#drinkText').text('You finished with '  + deck.count() + ' cards!').css('width', '100%');
                    $('#drink').css('background-color', 'rgba(0,150,0, 0.7)');
                break;
                case 'gameover':
                    $('#result').hide();
                    $('#drinkText').text('You ran out of cards! You must be hammered!').css('width', '100%');
                    $('#drink').css('background-color', 'rgba(255,0,0, 0.7)');
                break;
            }
    	}

    	function displayCard(elm, card){
    		var rankClass = "rank-" + card.rank;
    		elm.attr('class', "card " + rankClass + " " + suitClass[card.suit]);
    		elm.find('.rank').text(card.rank);
    		elm.find('.suit').html("&"+suitClass[card.suit]+";");
    	}
    	function updateBoard(){
    		$('.card', '.cardContainer').removeClass('selected');
    		$('#card' + pos).addClass('selected').parent('.cardContainer').addClass('selected');

    		$('#currentRank').html($('#card' + pos).find('.rank').text());

    	}
  
    	function newCard(hilo){
            if($('#drink').css('display') == 'block'){
                return false;
            }
    		var newCard = deck.draw();
    		var oldCard = $('#card' + pos);
    		while(newCard !== null && newCard.rank == 'N'){
    			newCard = deck.draw();
    		}
    		if(newCard == null){
    			gameover(true);
    		}
    		var val = cardVal[oldCard.find('.rank').text()];
    		var newVal = cardVal[newCard.rank];
    		var result;
    		if(newVal > val){
    			result = 'higher';
    		}else if( newVal === val){
    			result = 'equal';
    		}else{
    			result = 'lower';
    		}
    		$('#used' + pos).append($('<li>').append(oldCard.clone()));
    		displayCard($('#card' + pos), newCard);
            displayCard($('#resultCard'), newCard);
    		checkCall(result, hilo);
    	}

    	function checkCall(result, hilo){
    		if(result === hilo){
    			handleResult(true, false)
    		}else if (result == 'equal'){
    			handleResult(false, true)
    		}else{
    			handleResult(false, false)
    		}
    	}

    	function handleResult(correct, doubleDrink){
    		if(correct){
    			showResult('correct', nextCard);
    		}else if(doubleDrink){
    			showResult('double', prevCard);
    		}else{
    			//DRINK
    			showResult('single', prevCard);
    		}
    	}

    	function nextCard(){
    		if(direction == "forward"){
    			nextPos = pos += 1;
    			if(nextPos > 6){
    				$("#dirArrow").html("&larr;");
	    			direction = "backwards";
	    			nextPos = 6;
	    		}else if((nextPos == 2)||(nextPos == 5)){
	    			//RIVER
	    			showResult('river');
	    		}
    		}else{
    			nextPos = pos -= 1;
    			if(nextPos < 0){
    				gameover();
    			}else if((nextPos == 1)||(nextPos == 4)){
    				//RIVER
    				showResult('river');
    			}
    		}
    		pos = nextPos;
    		updateBoard();
		}
    	function prevCard(){
    		if(direction == "forward"){
    			nextPos = pos -= 1;
    			if(nextPos < 0){
	    			nextPos = 0;
	    		}else if((nextPos == 1)||(nextPos == 4)){
	    			//RIVER
	    			showResult('river');
	    		}
    		}else{
    			nextPos = pos += 1;
    			if(nextPos > 6){
    				$("#dirArrow").html("&rarr;");
    				direction = "forward";
    				nextPos = 6;
    			}else if((nextPos == 2)||(nextPos == 5)){
    				//RIVER
    				showResult('river');
    			}
    		}
    		pos = nextPos;
    		updateBoard();
    	}
    	function gameover(out){
    		if(out){
    			showResult('gameover');
    		}else{
    			showResult('finish');
    		}
    	}

        function revealCard(){
            $('.back').removeClass('back');
        }
        function hideCards(){
            $('#card' + pos).addClass('back');
            $('#resultCard').addClass('back');
        }

        $(document).keydown(function(e){
            if (e.keyCode == 38) { 
               newCard('higher');
               return false;
            }else if(e.keyCode == 40){
                newCard('lower');
               return false;
            }else if(e.keyCode == 13){
                $('#drink').click();
            } 

        });

    </script>
</head>
<body>
	
    <div class="container-fluid">
    	<div class="row-fluid">
    		<div id="dirArrow">&rarr;</div>
    	</div>
    	<div class="row-fluid choice">
    		<button class="btn btn-info" onclick="newCard('higher')">Higher</button>
    	</div>
    	<div class="row-fluid">
    		<div class="playingCards faceImages">
    			<div class="cardContainer">
		    		<div id="card0" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="cardContainer">
					<div id="card1" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="river"></div>
				<div class="cardContainer">
					<div id="card2" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="cardContainer">
					<div id="card3" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="cardContainer">
					<div id="card4" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="river"></div>
				<div class="cardContainer">
					<div id="card5" class="card">
					   <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
				<div class="cardContainer">
					<div id="card6" class="card">
					    <span class="rank"></span>
					    <span class="suit"></span>
					</div>
				</div>
			</div>
    	</div>

    	<div class="row-fluid choice">
    		<button onclick="newCard('lower')" class="btn btn-inverse">Lower</button>
    	</div>
    	<div class="row-fluid" id="hilotext">
    		Higher/Lower <span id="currentRank"></span>
    	</div>
    	<div class="row-fluid"></div>
    	<div class="row-fluid"><button class="btn btn-danger"  style="float:right;" onclick="newGame();">New Game</button></div>
    	<div class="row-fluid">
    		<div class="playingCards faceImages">
    			<ul id="used0" class="hand">
    			</ul>
    			<ul id="used1" class="hand">
    			</ul>
    			<div class="river"></div>
    			<ul id="used2" class="hand">
    			</ul>
    			<ul id="used3" class="hand">
    			</ul>
    			<ul id="used4" class="hand">
    			</ul>
    			<div class="river"></div>
    			<ul id="used5" class="hand">
    			</ul>
    			<ul id="used6" class="hand">
    			</ul>
    		</div>
    	</div>
    	<div id="drink">
            <div id="result">
            <div style="margin: 0 10px;" class="playingCards">
                <div id="resultCard" class="card">
                            <span class="rank"></span>
                            <span class="suit"></span>
                        </div>
                </div>
            </div>
            <div id='drinkText'></div>
        </div>
    </div>
        
</body>
</html>